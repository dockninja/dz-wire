syntax = "proto3";

package dotily.billing.v1;

import "dotily/billing/v1/billing.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/dockninja/dz-wire/gen/go/dotily/billing/v1;pbbilling";

enum SubscriptionStatus {
  SUBSCRIPTION_STATUS_UNSPECIFIED = 0;
  SUBSCRIPTION_STATUS_TRIALING = 1;
  SUBSCRIPTION_STATUS_ACTIVE = 2;
  SUBSCRIPTION_STATUS_PAST_DUE = 3;
  SUBSCRIPTION_STATUS_UNPAID = 4;
  SUBSCRIPTION_STATUS_PAUSED = 5;
  SUBSCRIPTION_STATUS_CANCELED = 6;
  SUBSCRIPTION_STATUS_INCOMPLETE = 7;
  SUBSCRIPTION_STATUS_EXPIRED = 8;
}

message Subscription {
  string id = 1; // UUID (db PK)
  string user_id = 2; // UUID

  BillingProvider provider = 3;
  string subscription_id = 4; // provider id (unique per provider)
  SubscriptionStatus status = 5;

  string plan_code = 6; // required (stable internal key)
  string plan_id = 7; // UUID, empty => NULL

  google.protobuf.Timestamp current_period_start = 8; // nullable (unset => NULL)
  google.protobuf.Timestamp current_period_end = 9; // nullable
  bool cancel_at_period_end = 10;

  google.protobuf.Timestamp canceled_at = 11; // nullable
  google.protobuf.Timestamp ended_at = 12; // nullable
  google.protobuf.Timestamp trial_end = 13; // nullable

  google.protobuf.Struct metadata = 14; // JSONB object

  google.protobuf.Timestamp created_at = 15;
  google.protobuf.Timestamp updated_at = 16;
}

message UpsertSubscriptionParams {
  Subscription subscription = 1;
}

message UpsertSubscriptionResult {
  Subscription subscription = 1;
}
