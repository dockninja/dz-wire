// event.proto
syntax = "proto3";

package dotily.activity.v1;

import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/dockninja/dz-wire/gen/go/dotily/activity/v1;pbactivity";

enum EventKind {
  EVENT_KIND_UNSPECIFIED = 0;
  EVENT_KIND_DOMAIN = 1;
  EVENT_KIND_NOTIFICATION = 2;
}

// Adjust these to match your SQL enum app.event_severity if it differs.
enum EventSeverity {
  EVENT_SEVERITY_UNSPECIFIED = 0;
  EVENT_SEVERITY_INFO = 1;
  EVENT_SEVERITY_WARNING = 2;
  EVENT_SEVERITY_ERROR = 3;
  EVENT_SEVERITY_CRITICAL = 4;
}

// Adjust these to match your SQL enum app.delivery_status if it differs.
enum DeliveryStatus {
  DELIVERY_STATUS_UNSPECIFIED = 0;
  DELIVERY_STATUS_PENDING = 1;
  DELIVERY_STATUS_SENT = 2;
  DELIVERY_STATUS_DELIVERED = 3;
  DELIVERY_STATUS_FAILED = 4;
}

message Event {
  // Identity
  string id = 1; // UUID
  string user_id = 2; // UUID
  string domain_id = 3; // UUID

  // Classification
  EventKind kind = 4; // domain | notification
  string event_type = 5; // dns_changed, whois_changed, expires_soon, notification_sent...
  EventSeverity severity = 6;

  // Timeline
  google.protobuf.Timestamp occurred_at = 7;

  // Optional links
  optional string dns_snapshot_id = 8; // UUID
  optional string whois_snapshot_id = 9; // UUID
  optional string source_event_id = 10; // UUID (self-ref)

  // Notification fields (only meaningful when kind=NOTIFICATION)
  optional string channel = 11; // telegram/email/webhook/...
  optional DeliveryStatus delivery_status = 12;
  optional google.protobuf.Timestamp sent_at = 13;
  optional string provider_ref = 14;
  optional string error = 15;

  // Payload / extra data
  google.protobuf.Struct payload = 16; // JSONB object
}
